<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Goblins Inferno</title>
    <script>
      (function(){
        const urlV = new URLSearchParams(location.search).get('v');
        const DEFAULT_V = 'dev-' + Date.now();
        const v = window.APP_VERSION || urlV || DEFAULT_V;
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = 'src/css/style.css?v=' + encodeURIComponent(v);
        document.head.appendChild(link);
        window.APP_VERSION = v;
      })();
    </script>
    <script>
      // Simple client-side live reload: polls live-reload.json when present
      (function(){
        let lastSeen = null;
        async function check() {
          try {
            const res = await fetch('live-reload.json?_=' + Date.now(), { cache: 'no-store' });
            if (res.ok) {
              const data = await res.json();
              if (lastSeen && lastSeen !== data.version) {
                const u = new URL(location.href);
                u.searchParams.set('v', String(Date.now()));
                location.href = u.toString();
                return;
              }
              lastSeen = data.version;
            }
          } catch {}
          setTimeout(check, 800);
        }
        check();
      })();
    </script>
</head>
<body>
    <div id="hud" class="hud">
        <div>Debt: <span id="hud-debt">0</span></div>
        <div>Gold: <span id="hud-gold">0</span></div>
        <div>Lvl: <span id="hud-level">1</span></div>
        <div>XP: <span id="hud-xp">0</span>/<span id="hud-next">5</span></div>
        <div>HP: <span id="hud-hp">100</span></div>
        <div>FPS: <span id="hud-fps">0</span></div>
        <button id="btnMenu" class="hud-btn" title="Open menu">Menu</button>
        <div id="hudMenuPanel" class="hud-menu-panel">
          <button id="btnResume" class="hud-btn">Resume</button>
          <button id="btnMute" class="hud-btn">Mute</button>
          <button id="btnMeta" class="hud-btn">Shop</button>
          <button id="btnLoan" class="hud-btn">Loan Shark</button>
          <button id="btnReset" class="hud-btn" title="Reset progression">Reset</button>
          <button id="btnFullscreen" class="hud-btn" style="display:none;">Fullscreen</button>
          <div class="hud-zoom-row">
            <span class="hud-zoom-label">Zoom:</span>
            <button id="btnZoomOut" class="hud-btn" title="Zoom Out">−</button>
            <button id="btnZoomIn" class="hud-btn" title="Zoom In">+</button>
          </div>
        </div>
    </div>
    <!-- Active Buffs HUD -->
    <div id="buffsHUD" class="buffs-hud"></div>
    <!-- Stats Box (bottom-left) -->
    <div id="statsBox" class="stats-box">
      <div class="stats-row"><span class="stats-key">Fire Rate</span><span id="stats-fire" class="stats-val">100%</span></div>
      <div class="stats-row"><span class="stats-key">Damage</span><span id="stats-damage" class="stats-val">100%</span></div>
      <div class="stats-row"><span class="stats-key">Run Speed</span><span id="stats-speed" class="stats-val">100%</span></div>
      <div class="stats-row"><span class="stats-key">Proj. Size</span><span id="stats-size" class="stats-val">100%</span></div>
    </div>
    <canvas id="gameCanvas"></canvas>
    <!-- Touch Controls for mobile -->
    <div id="touchControls" class="touch-controls">
      <div id="moveStick" class="stick"><div class="knob"></div></div>
      <div id="aimStick" class="stick"><div class="knob"></div></div>
    </div>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display:flex;">
      <div class="loading-box">
        <div class="loading-title">Loading…</div>
        <div class="loading-bar"><div id="loadingProgress" class="loading-progress" style="width:0%"></div></div>
      </div>
    </div>
    <div id="upgradeModal" class="modal" style="display:none;">
        <div class="modal-content">
            <h2>Choose an Upgrade</h2>
            <div class="choices">
                <button id="choice0" class="choice">
                    <div id="choice0-title" class="choice-title">—</div>
                    <div id="choice0-desc" class="choice-desc">—</div>
                </button>
                <button id="choice1" class="choice">
                    <div id="choice1-title" class="choice-title">—</div>
                    <div id="choice1-desc" class="choice-desc">—</div>
                </button>
                <button id="choice2" class="choice">
                    <div id="choice2-title" class="choice-title">—</div>
                    <div id="choice2-desc" class="choice-desc">—</div>
                </button>
            </div>
        </div>
    </div>
    <!-- Loan Shark Modal -->
    <div id="loanModal" class="modal" style="display:none;">
        <div class="modal-content">
            <h2>The Loan Shark</h2>
            <p>Take a loan to power up — but it adds to your debt.</p>
            <div class="choices">
                <button id="loanSimple" class="choice">
                    <div class="choice-title">Simple Loan</div>
                    <div class="choice-desc">+500 gold (10% interest)</div>
                </button>
                <button id="loanGear" class="choice">
                    <div class="choice-title">Gear Loan</div>
                    <div class="choice-desc">+1000 gold (25% interest)</div>
                </button>
                <button id="loanCursed" class="choice">
                    <div class="choice-title">Cursed Loan</div>
                    <div class="choice-desc">+2000 gold (50% interest)</div>
                </button>
            </div>
            <div style="margin-top:12px; text-align:right;">
                <button id="loanClose" class="hud-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Start Screen -->
    <div id="startModal" class="modal" style="display:flex;">
        <div class="modal-content start-content">
            <div class="start-overlay">
                <h1 class="start-title">Goblin's Inferno</h1>
                <button id="btnStartGame" class="hud-btn start-btn">Start</button>
            </div>
        </div>
    </div>

    <!-- Character Selection Modal -->
    <div id="charModal" class="modal" style="display:none;">
        <div class="modal-content">
            <h2>Choose Your Goblin</h2>
            <div class="choices">
                <button id="pickGnorp" class="choice">
                    <div class="choice-sprite"></div>
                    <div class="choice-title">Gnorp the Pyromaniac</div>
                    <div class="choice-desc">High damage. Extra close-range damage.</div>
                </button>
                <button id="pickIgnis" class="choice">
                    <div class="choice-sprite"></div>
                    <div class="choice-title">Ignis the Arsonist</div>
                    <div class="choice-desc">Fast and mobile. Leaves fire trails.</div>
                </button>
                <button id="pickFizzle" class="choice">
                    <div class="choice-sprite"></div>
                    <div class="choice-title">Fizzle the Alchemist</div>
                    <div class="choice-desc">Powerups on coin pickup.</div>
                </button>
            </div>
        </div>
    </div>
    <script>
      (function(){
        const v = window.APP_VERSION || 'dev';
        const s = document.createElement('script');
        s.type = 'module';
        s.src = 'src/js/main.js?v=' + encodeURIComponent(v);
        document.body.appendChild(s);
      })();
</script>

    <!-- Game Over Modal -->
    <div id="gameOverModal" class="modal" style="display:none;">
        <div class="modal-content">
            <h2>You Died</h2>
            <p id="gameOverStats"></p>
            <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
              <button id="btnGameOverMeta" class="hud-btn">Shop</button>
              <button id="btnRestart" class="hud-btn">Restart</button>
            </div>
        </div>
    </div>

    <!-- Victory Modal -->
    <div id="gameWinModal" class="modal" style="display:none;">
        <div class="modal-content">
            <h2>Inferno Conquered!</h2>
            <p id="gameWinStats">—</p>
            <div style="display:flex; gap:8px; justify-content:flex-end; margin-top: 12px;">
                <button id="btnWinMeta" class="hud-btn">Shop</button>
                <button id="btnWinContinue" class="hud-btn">Continue</button>
                <button id="btnWinRestart" class="hud-btn">Restart</button>
            </div>
        </div>
    </div>

    <!-- Meta Progression Modal -->
    <div id="metaModal" class="modal" style="display:none;">
      <div class="modal-content">
        <h2>Meta Progression</h2>
        <p>Gold: <b id="metaGold">0</b></p>
        <div class="choices">
          <div class="choice">
            <div class="choice-title">Multishot</div>
            <div class="choice-desc">Adds +2 shots per level. Level: <span id="meta-multishot-level">0</span>. Cost: <span id="meta-multishot-cost">1</span></div>
            <button id="meta-multishot-buy" class="hud-btn">Buy</button>
          </div>
          <div class="choice">
            <div class="choice-title">Bouncing Shots</div>
            <div class="choice-desc">Adds +1 wall bounce per level. Level: <span id="meta-bounce-level">0</span>. Cost: <span id="meta-bounce-cost">1</span></div>
            <button id="meta-bounce-buy" class="hud-btn">Buy</button>
          </div>
          <div class="choice">
            <div class="choice-title">Magnetic Range</div>
            <div class="choice-desc">Increases pickup radius by 20px per level. Level: <span id="meta-magnet-level">0</span>. Cost: <span id="meta-magnet-cost">1</span></div>
            <button id="meta-magnet-buy" class="hud-btn">Buy</button>
          </div>
          <div class="choice">
            <div class="choice-title">Penetration</div>
            <div class="choice-desc">Adds +1 enemy penetration per level. Level: <span id="meta-pierce-level">0</span>. Cost: <span id="meta-pierce-cost">1</span></div>
            <button id="meta-pierce-buy" class="hud-btn">Buy</button>
          </div>
        </div>
        <div style="margin-top:12px; text-align:right;">
          <button id="metaClose" class="hud-btn">Close</button>
        </div>
      </div>
    </div>
</body>
</html>
